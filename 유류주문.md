# 유류주문

## 주문 기능 구현
* 주문 기능은 기존 파트너웹 주문포탈의 것과 거의 동일하게 구현
	+ 윤활유 주문 입력을 일반 유류 주문 UI와 동일하게 변경
	+ 주문목록에서 윤활유 주문 상세조회,수정하는 기능(기존 화면은 수정이 불가했음.)은 윤활유 출하조회 > 상세조회 화면으로 통합.
	+ 선박동정, 벙커링 업무기능은 글로벌시스템 2차 고도화 프로젝트에 포함하여 개발함. 
* 기존 파트너웹 주문포탈은 SAP UI5로 개발되었고, 외부 엔지니어가 소스 분석
	+ 분석설계서 :  Y:\02. 분석\05. 현행시스템분석\UI5\UI5분석설계서
* 기존 RFC를 복사하여 EBIZ에 맞게 수정 : Z_SD_XXX -> Z_EB_XXX
* 기존 RFC의 데이타 구조는 item list를 xml 형태로 전송하였으나 ebiz에서는 table 형태로 변환하여 적용.

## 중간납지처, 납지처
* 중간납지처, 납지처 코드로도 ebiz에 로그인하여 주문하지만, 주문데이타는 해당 고객(판매처,sp) 데이타로 생성됨.
* 중간납지처 및 납지처로 로그인 했을 경우에는 해당 하위 납지처의 주문목록만 조회됨. (해당 RFC 기능 수정. Z_EB_OPW004)
* 중간납지처로 로그인한 경우 납지처 팝업의 목록은 해당 하위 납지처 목록만 조회됨. (해당 RFC 기능 수정. Z_EB_OCC005_N)
  + 이러한 변경으로 인해 기존 주문포탈에서는 최근 주문 납지처 목록이 기본으로 조회되지만, ebiz에서는 하위 납지처 모두 기본으로 조회됨.

## 주문입력, 수정, 삭제
* 용차 주문은 납품처별로 주문번호가 생성됨.
* 자차 주문은 주문아이템별로 주문번호가 생성됨.
* 주문데이타는 주문을 수정하면 기존 주문번호가 삭제되고 새로운 주문번호로 생성되는 구조.
* 목록에서 삭제하면 선택한 주문과 동일한 주문번호 및 선적번호의 주문이 같이 삭제됨.
  
## 합배차 주문
* ROLE_CHAIN 권한을 가진 거래처는 합배차 주문 메뉴가 활성화 된다.
* 관리하는 주유소가 여러 개인 고객이 자차 주문 시 동일 배차로 주문,수송하기 위한 기능.
* 합배차 주문으로 여러 거래처의 주문을 같이 입력할 수 있지만, 입력된 주문의 조회는 각각의 거래처로 로그인해야 조회할 수 있음.
	+ 주문목록에서 합배차(=동일 선적번호) 주문목록을 별도로 조회할 수 있는 팝업 조회 기능 구현. 자차 주문인 경우에만 활성화. 
	
## 주문 알림톡
* 주문입력, 수정, 취소 시 판매처(sp)의 거래처 마스터에 등록된 휴대폰 번호 및 추가수신전화번호로 알림이 전송된다.
	+ 중간납지처/납지처 로그인 주문 시에도 판매처(SP)의 연락처로 알림이 전송된다.
	+ 거래처 마스터의 주문알림 수신여부가 'Y'인 경우에만 전송된다.
	+ 합배차 주문의 경우 전체 주문내역이 로그인한 판매처로 알림이 전송된다.
* 해당 영업사원에게도 동일한 내용으로 알림이 전송된다.
* 알림톡 템플릿
	+ EBZ_0100 : 주문입력/수정, 채권정보(한도초과,기일초과 등) 있는 경우
	+ EBZ_0101 : 주문취소.
	+ EBZ_0114 : 주문입력/수정, 채권정보(한도초과,기일초과 등) 없는 경우
	
## 배차 정보 조회
* 실시간 배차 정보를 물류시스템과 연동하여 팝업화면으로 제공한다.
* 주문번호를 파라미터로 물류시스템 배차조회 페이지 호출
	+ 주문번호는 파라미터는  base64.min.js, base64rewrite.js 의 함수로 변환하여 전달
	+ 물류시스템의 운영환경 링크만 제공됨.
	+ 실제 이동 중인 배차의 주문번호로만 조회가능
	
## 모바일 기능
* B2B 주문과 현황자료는 모바일 구현 제외. (현황자료-거래명세서는 모바일 구현)

	
